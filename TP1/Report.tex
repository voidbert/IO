\documentclass[12pt, a4paper, titlepage]{article}

\usepackage{amsmath}
\usepackage[portuguese]{babel}
\usepackage{cite}
\usepackage{enumerate}
\usepackage{float}
\usepackage[a4paper, margin=2cm]{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{lscape}
\usepackage{setspace}
\usepackage{xcolor}

\chardef\_=`_

\title{\textbf{
    Investigação Operacional -- Trabalho Prático I  \\
    \large Problema de Empacotamento a Uma Dimensão
}}
\author{
    \begin{tabular}{ll}
        Ana Carolina Penha Cerqueira       & A104188 \\
        Humberto Gil Azevedo Sampaio Gomes & A104348 \\
        Ivo Filipe Mendes Vieira           & A103999 \\
        José António Fernandes Alves Lopes & A104541 \\
        José Rodrigo Ferreira Matos        & A100612 \\
    \end{tabular}
}
\date{23 de março de 2024}

\begin{document}

\onehalfspacing
\setlength{\parskip}{\baselineskip}
\setlength{\parindent}{0pt}
\def\arraystretch{1.5}

\maketitle

\begin{abstract}
    Este trabalho prático de Investigação Operacional tem como objetivo a resolução de um problema
    de empacotamento a uma dimensão utilizando o modelo de "um-corte", de Dyckhoff. \cite{dyckhoff}
    Em detalhe, procura-se a formulação do problema, a sua modelação, a sua resolução, e a validação
    do modelo construído.

    % TODO - adicionar que fizemos meta programação
\end{abstract}

\setcounter{section}{-1}
\section{Dados do problema}

Como exigido pelo enunciado, os dados do problema a resolver são determinados em função do número de
aluno mais elevado de entre os integrantes do grupo. No caso, este é A104541, que corresponde ao
aluno José Lopes, e dá origem aos seguintes dados:

\begin{table}[H]
    \begin{center}
        \begin{tabular}{c|c}
            Capacidade & Quantidade de contentores \\
            \hline
            11          & Ilimitada                 \\
            10          & 5                         \\
            7           & 5
        \end{tabular}
    \end{center}
    \caption{Número de contentores de cada comprimento disponíveis.}
    \label{containers-data}
\end{table}

\begin{table}[H]
    \begin{center}
        \begin{tabular}{c|c}
            Comprimento & Quantidade de itens \\
            \hline
            1           & 0                    \\
            2           & 13                   \\
            3           & 0                    \\
            4           & 9                    \\
            5           & 5
        \end{tabular}
    \end{center}
    \caption{Número de itens de cada comprimento para empacotar.}
    \label{items-data}
\end{table}

A soma dos comprimentos dos itens a empacotar é dada por:

$$2 \times 13 + 4 \times 9 + 5 \times 5 = 87$$

\section{Formulação do problema}

Pretende-se resolver um problema de empacotamento a uma dimensão, i.e., pretende-se determinar como
se deve distribuir um conjunto de itens por contentores. É necessário ter em conta que deve ser
atribuído exatamente um contentor a cada item, ou seja, um dado item não pode estar em mais do que
um contentor, e não pode haver itens que não tenham um contentor associado. Ademais, a soma dos
comprimentos dos itens em qualquer contentor não pode ultrapassar a sua capacidade.

Neste problema em específico, estão disponíveis contentores de capacidades 11, 10 e 7, sendo que há
contentores e capacidade 11 em número ilimitado, enquanto que há apenas 5 contentores de cada uma
das outras capacidades (tabela \ref{containers-data}). Pretendem-se empacotar 13 itens de
comprimento 2, 9 itens de comprimento 4, e 5 itens de comprimento 5 (tabela \ref{items-data}). O
objetivo é minimizar a soma das capacidade dos contentores utilizados.

% TODO - Descrever modelo de Dyckhoff

\section{Metaprogramação}

A expansão dos vários sumatórios do modelo de um-corte é, devido à sua dimensão, difícil de ser
executada manualmente. O processo não só é demorado, como também propício a erros de cálculo
difíceis de diagnosticar: uma solução errada ou a ausência de solução no modelo final apenas indica
a existência de um erro, mas não a sua localização. Ademais, o processo laborioso de criação do
modelo teria de ser repetido caso os dados iniciais do problema sofressem alterações, uma ocorrência
constante no mundo real. Para endereçar este problema, desenvolvemos \emph{scripts} em Python que
geram o modelo LP automaticamente.

\subsection{Modelo do um-corte}

O nosso \emph{script} para a implementação deste modelo encontra-se em anexo (ver
\ref{code:one-cut}) e o seu funcionamento passo a passo é descrito abaixo.

\begin{enumerate}[\hspace{1cm} \bfseries 1.]
    \item Calcular o conjunto de resíduos ($R$), sucessivamente executando todos os cortes possíveis
        com base nas capacidades dos contentores e nos comprimentos dos itens.

    \item Gerar a função objetivo de acordo com o artigo, em particular, a variação que assume que
        cortes não utilizados são desperdício. \cite{dyckhoff}. É necessária a geração de variáveis
        e restrições auxiliares para se calcular o máximo entre $0$ e uma função linear.

    \item Gerar as restrições de equilíbrio, calculando os conjuntos e os sumatórios descritos no
        artigo. \cite{dyckhoff}

    \item Gerar restrições relativas ao número máximo de contentores de cada capacidade: o número
        de contentores de uma dada capacidade que foram usados é dado pela sua parcela
        correspondente no sumatório exterior da função objetivo. Estes valores já são representados
        pelas variáveis auxiliares do segundo ponto.

    \item Registar que todas as variáveis de corte são inteiras.

    % TODO - as fórmulas da descrição do modelo devem ser numeradas, para referenciar aqui
\end{enumerate}

\subsection{Modelo dos padrões de corte}

Inicialmente, o nosso grupo resolveu o problema de empacotamento proposto utilizando o modelo dos
padrões de corte, de modo a poder verificar a solução do modelo de um-corte quando este fosse
implementado. Também desenvolvemos um \emph{script} que gera o modelo de Gilmore e Gomory
automaticamente, cujo funcionamento passo a passo é descrito de abaixo, e cujo código se encontra em
anexo (ver \ref{code:cutting-patterns}).

% TODO - citar e dizer que não descrevemos os seu funcionamento aqui

\begin{enumerate}[\hspace{1cm} \bfseries 1.]
    \item Calcular os padrões de corte para cada contentor dado o comprimento de cada item a
        empacotar. Isto é implementado recursivamente: procura-se cortar um comprimento em duas
        partes menores, uma das quais é o comprimento de um item. Calculam-se os padrões de corte da
        outra parte, e usa-se esse resultado para construir os padrões de corte relativos ao
        comprimento total. Um comentário LP é gerado para enumerar todos os padrões de corte
        calculados.

    \item Gerar a função objetivo: conhecem-se todas as variáveis (padrões de corte), cujos
        coeficientes são as capacidades dos contentores a que estão associadas, dado que se pretende
        minimizar a soma das capacidades dos contentores utilizados.

    \item Calcular quanto cada padrão de corte gera de cada item, e usar essa informação para gerar
        restrições que obrigam que pelo menos um dado número de cada item seja empacotado.

    \item Gerar restrições relativas ao número máximo de contentores de cada capacidade: a soma de
        todos os padrões de corte que envolvem contentores de uma capacidade não pode ser superior à
        disponibilidade desse contentor.

    \item Registar que todas as variáveis correspondentes a padrões de corte são inteiras.
\end{enumerate}

% Isto é uma grande gambiarra, mas funciona para pôr a bibliografia como uma secção.
\section{Bibliografia}
\def\refname{}
\vspace{-1.5cm}
\begin{thebibliography}{9}
    \bibitem{dyckhoff}
    H. Dyckhoff, "A New Linear Programming Approach to the Cutting Stock Problem",
    \emph{Operations Research}, vol. 29, no. 6, Dec., pp. 1092-1104, 1981.
    \href{https://doi.org/10.1287/opre.29.6.1092}{doi: 10.1287/opre.29.6.1092}
\end{thebibliography}

\section{Anexos}

\lstdefinestyle{codestyle}{
    commentstyle=\color{teal},
    keywordstyle=\color{blue},
    numberstyle=\ttfamily\color{gray},
    stringstyle=\color{red},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=false,
    keepspaces=true,
    numbers=left,
    numbersep=10pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    xleftmargin=3em
}
\lstset{style=codestyle}

\begin{landscape}

\subsection{\emph{Script} gerador do modelo de um-corte}
\label{code:one-cut}
\lstinputlisting[language=python]{dyckhoff.py}
\pagebreak

\subsection{\emph{Script} gerador do modelo de padrões de corte}
\label{code:cutting-patterns}
\lstinputlisting[language=python]{gilmore_gomory.py}

\end{landscape}

\end{document}
